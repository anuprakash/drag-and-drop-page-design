<!DOCTYPE html>
<html>
<head>
    <title>...</title>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />
    <style>
        .table-layout tr td {
            /*border: 1px dashed #ddd !important;*/
            padding: 15px;
        }

        .table-panel tr td {
            border: 1px dashed #eee !important;
            padding: 15px;
        }

        [contenteditable="true"]:active,
        [contenteditable="true"]:focus {
            padding: 5px 15px;
            font-size: 15px;
            line-height: 1.42857;
            color: #2C3E50;
            background-color: #FFF;
            background-image: none;
            border: 1px solid #DCE4EC;
            border-radius: 4px;
            box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.075) inset;
            transition: border-color 0.15s ease-in-out 0s, box-shadow 0.15s ease-in-out 0s;
        }

        [contenteditable="true"]:hover {
            outline: 2px dashed #0090D2;
        }

        .SizeChooser {
            margin: 5px 10px;
            position: relative;
            text-align: center;
        }

            .SizeChooser table {
                border-collapse: separate;
                border-spacing: 3px;
            }

            .SizeChooser td {
                cursor: pointer;
                height: 10px;
                min-width: 10px;
                line-height: 10px;
                border: 1px solid #CCC !important;
                padding: 0 !important;
            }

        .SizeChooser-hover {
            background-color: red;
        }

        .SizeChooser-selected {
            border: 1px #333 solid !important;
        }

        .SizeChooser input {
            width: 40px;
        }

        .ui-selecting {
            background: blue;
        }

        .ui-selected {
            background: green;
        }
    </style>
</head>
<body class="container">
    <br />

    <div class="well text-center">
        <div class="btn-group">
            <button type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" title='@Html.Localize("btn_color")'>
                <i class="fa fa-table fa-2x"></i>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li style="height: 242px; width: 220px">
                    <div class="SizeChooser" data-id="PageLayout">
                        <table><tbody><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr></tbody></table>
                        <input class="input-sm"><span> x </span><input class="input-sm">
                        <button class="btn btn-sm">Generate</button>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="row" id="PageLayout">

    </div>

    <!--Kýlavuz panel-->
    <div class="panel hidden">
        <div class="panel-heading">
            <span><i class="fa fa-edit contenteditable" style="cursor: pointer"></i> <span contenteditable="false">New panel</span></span>
            <div class="pull-right">
                <!--<a class="btn btn-xs btn-default move-cursor"><i class="fa fa-arrows"></i></a>-->
                <button type="button" class="btn btn-xs btn-default panel-toggle" title='@Html.Localize("btn_toggle")'>
                    <i class="fa fa-caret-down"></i>
                </button>
                <div class="btn-group">
                    <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" title='@Html.Localize("btn_color")'>
                        <i class="fa fa-eye"></i>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li class="bg-gray" data-color="default">
                            <a>&nbsp;</a>
                        </li>
                        <li class="bg-danger" data-color="danger">
                            <a>&nbsp;</a>
                        </li>
                        <li class="bg-success" data-color="success">
                            <a>&nbsp;</a>
                        </li>
                        <li class="bg-info" data-color="info">
                            <a>&nbsp;</a>
                        </li>
                        <li class="bg-warning" data-color="warning">
                            <a>&nbsp;</a>
                        </li>
                        <li class="bg-primary" data-color="primary">
                            <a>&nbsp;</a>
                        </li>
                    </ul>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" title='@Html.Localize("btn_color")'>
                        <i class="fa fa-table"></i>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li style="height: 242px; width: 220px">
                            <div class="SizeChooser">
                                <table><tbody><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr></tbody></table>
                                <input class="input-sm"><span> x </span><input class="input-sm">
                                <button class="btn btn-sm">Generate</button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="panel-body">
            <table class="table-panel table table-bordered"></table>
        </div>
    </div>
    <!--Kýlavuz panel-->

    <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <!--<script src="tablemerge.js"></script>-->
    <script src="panelhelper.js"></script>

    <!--data showing in view-->
    <script>
        var sections = [
            {
                Id: 1, Name: 'Section-1', RowOrder: 1, Colspan: 1, Rowspan: 1, Color: 'panel-success', RowCount: 2,
                Fields: [
                { FieldId: 1, Name: 'isim', RowOrder: 1, Colspan: 1, Rowspan: 1 },
                { FieldId: 2, Name: 'soyisim', RowOrder: 1, Colspan: 1, Rowspan: 1 },
                { FieldId: 3, Name: 'il', RowOrder: 2, Colspan: 2, Rowspan: 1 }]
            },
            {
                Id: 2, Name: 'Section-2', RowOrder: 1, Colspan: 1, Rowspan: 1, Color: 'panel-info', RowCount: 2,
                Fields: [
                { FieldId: 1, Name: 'isim', RowOrder: 1, Colspan: 1, Rowspan: 1 },
                { FieldId: 1, Name: 'soyisim', RowOrder: 2, Colspan: 1, Rowspan: 1 }]
            },
            {
                Id: 3, Name: 'Section-3', RowOrder: 2, Colspan: 2, Rowspan: 1, Color: 'panel-danger', RowCount: 2,
                Fields: [
                { FieldId: 1, Name: 'isim', RowOrder: 1, Colspan: 1, Rowspan: 1 },
                { FieldId: 2, Name: 'soyisim', RowOrder: 1, Colspan: 1, Rowspan: 1 },
                { FieldId: 3, Name: 'email', RowOrder: 1, Colspan: 1, Rowspan: 1 },
                { FieldId: 4, Name: 'il', RowOrder: 2, Colspan: 2, Rowspan: 1 },
                { FieldId: 5, Name: 'ilçe', RowOrder: 2, Colspan: 1, Rowspan: 1 }]
            }
        ];

        var layout = { Id: 1, RowCount: 2, Sections: sections };


        $(function () {
            var table = $('<table class="table table-bordered table-layout" />');

            for (var i = 0; i < layout.RowCount; i++) {
                var tr = $('<tr/>');
                $.each(layout.Sections, function () {
                    if (this.RowOrder == i + 1) {
                        var panel = $('.panel.hidden').clone()
                            .removeClass('hidden')
                            .addClass(this.Color);
                        panel.find('.panel-heading span [contenteditable]').attr('data-name', this.Name).html(this.Name);

                        if (this.Fields.length > 0) {
                            for (var j = 0; j < this.RowCount; j++) {
                                var pTr = $('<tr/>');
                                $.each(this.Fields, function () {
                                    if (this.RowOrder == j + 1) {
                                        var input = $('<input type="text" class="form-control">');
                                        var td = $('<td/>', {
                                            colspan: this.Colspan,
                                            rowspan: this.Rowspan
                                        }).append(this.Name);
                                        pTr.append(td);
                                    }
                                });
                                panel.find('.panel-body').attr('id', i); // benzersiz id
                                panel.find('.panel-heading .SizeChooser').attr('data-id', i); // benzersiz id
                                panel.find('.panel-body table').append(pTr);
                            }
                        }

                        tr.append($('<td/>', {
                            colspan: this.Colspan,
                            rowspan: this.Rowspan
                        }).append(panel));
                        //}).append(''));

                    }
                });
                table.append(tr);
            }

            $("#PageLayout").append(table);
        });
    </script>

    <!--table generator-->
    <script>
        $(function () {

            var sizeChooser = $('.SizeChooser');
            sizeChooser.each(function () {
                var trs = $(this).find('table tr'),
                    tds = $(this).find('table td');

                trs.each(function (i) {
                    var $tr = $(this);
                    $tr.attr('data-index', i + 1);
                    $tr.find('td').each(function (j) {
                        $(this).attr('data-index', j + 1);
                    });
                });

                tds.mouseover(function () {
                    var trIndex = $(this).closest('tr').data('index'),
                        tdIndex = $(this).data('index');

                    var inputs = $(this).closest('.SizeChooser').find('.input-sm');
                    inputs.eq(0).val(trIndex);
                    inputs.eq(1).val(tdIndex);

                    tds.removeClass('bg-info');
                    tds.each(function () {
                        var $td = $(this);
                        if ($td.closest('tr').data('index') < trIndex + 1 && $td.data('index') < tdIndex + 1) {
                            $td.addClass('bg-info');
                        }
                    });
                });
            });

            $('body').on('click', 'td.bg-info[data-index]', function () {
                var trIndex = $(this).closest('tr').data('index'),
                    tdIndex = $(this).data('index'),
                    table = $('#' + $(this).closest('.SizeChooser').data('id')).children('table');

                // yeni eklenen satýrdaki sütun sayýsý mevcut tablonun satýrlarýndaki en fazla sütun sayýsýna göre..


            });
        });
    </script>

    
    <!--only empty cell selectable-->
    <script>
        $(function () {
            $('table.table-layout, table.table-panel').selectable({
                filter: "td.empty",
                selecting: function (event, ui) {
                    var td = $(ui.selecting);

                    if (td.closest('table').hasClass('table-layout')) {
                        console.log('table-layout');
                    } else {
                        console.log('table-panel');
                    }

                    console.log(td);
                }
            });
        });
    </script>
</body>
</html>